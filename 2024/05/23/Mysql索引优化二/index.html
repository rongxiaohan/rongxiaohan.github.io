

<!DOCTYPE html>
<html lang="zh-Hans" color-mode=light>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Mysql索引优化二 - 笑容+</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate" />
  <meta name="keywords" content="技术博客, Java, Python, Node.js, Web 开发">
  <meta name="description" content="分页查询优化详解
🌟 一、基本分页查询语法最常见的分...">
  <meta name="author" content="单线程垃圾清理工">
  <link rel="icon" href="/images/icons/favicon-16x16.png" type="image/png" sizes="16x16">
  <link rel="icon" href="/images/icons/favicon-32x32.png" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png" sizes="180x180">
  <meta rel="mask-icon" href="/images/icons/stun-logo.svg" color="#333333">
  
    <meta rel="msapplication-TileImage" content="/images/icons/favicon-144x144.png">
    <meta rel="msapplication-TileColor" content="#000000">
  

  
<link rel="stylesheet" href="/css/style.css">


  
    
<link rel="stylesheet" href="https://at.alicdn.com/t/font_1445822_p6ry5n7lrr.css">

  

  
    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">

  

  
    
      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/solarized-dark.min.css" name="highlight-style" mode="light">

      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/solarized-dark.min.css" name="highlight-style" mode="dark">

      
  

  <script>
    var CONFIG = window.CONFIG || {};
    var ZHAOO = window.ZHAOO || {};
    CONFIG = {
      isHome: false,
      fancybox: true,
      pjax: false,
      loading: {
        gif: '/images/theme/loading.gif',
        lottie: ''
      },
      lazyload: {
        enable: true,
        only_post: 'false',
        loading: {
          gif: '/images/theme/loading.gif',
          lottie: ''
        }
      },
      donate: {
        enable: false,
        alipay: 'https://pic.izhaoo.com/alipay.jpg',
        wechat: 'https://pic.izhaoo.com/wechat.jpg'
      },
      galleries: {
        enable: true
      },
      fab: {
        enable: true,
        always_show: false
      },
      carrier: {
        enable: true
      },
      daovoice: {
        enable: false
      },
      preview: {
        background: {
          default: '',
          api: ''
        },
        motto: {
          default: '我在开了灯的床头下，想问问自己的心啊。',
          typing: true,
          api: 'https://v2.jinrishici.com/one.json',
          data_contents: '["data","content"]'
        },
      },
      qrcode: {
        enable: true,
        type: 'url',
        image: 'https://pic.izhaoo.com/weapp-code.jpg',
      },
      toc: {
        enable: true
      },
      scrollbar: {
        type: 'simple'
      },
      notification: {
        enable: false,
        delay: 4500,
        list: '',
        page_white_list: '',
        page_black_list: ''
      },
      search: {
        enable: false,
        path: ''
      }
    }
  </script>

  

  

<meta name="generator" content="Hexo 7.3.0"></head>

<body class="lock-screen">
  <div class="loading" id="loading"></div>
  
    


  <nav class="navbar">
    <div class="left">
      
        <i class="iconfont iconhome j-navbar-back-home"></i>
      
      
        <i class="iconfont iconqrcode j-navbar-qrcode"></i>
      
      
        <i class="iconfont iconmoono" id="color-toggle" color-toggle="light"></i>
      
      
    </div>
    <div class="center">Mysql索引优化二</div>
    <div class="right">
      <i class="iconfont iconmenu j-navbar-menu"></i>
    </div>
    
      <div id="qrcode-navbar"></div>
    
  </nav>

  
  

<nav class="menu">
  <div class="menu-container">
    <div class="menu-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <ul class="menu-content"><li class="menu-item">
        <a href="/ " class="underline "> 首页</a>
      </li><li class="menu-item">
        <a href="/galleries/ " class="underline "> 生活</a>
      </li><li class="menu-item">
        <a href="/archives/ " class="underline "> 归档</a>
      </li><li class="menu-item">
        <a href="/tags/ " class="underline "> 标签</a>
      </li><li class="menu-item">
        <a href="/categories/ " class="underline "> 分类</a>
      </li><li class="menu-item">
        <a href="/about/ " class="underline "> 关于</a>
      </li></ul>
    
      <div class="menu-copyright"><p></p></div>
    
  </div>
</nav>
  <main id="main">
  <div class="article-wrap">
    <div class="row container">
      <div class="col-xl-3"></div>
      <div class="col-xl-6"><article class="article">
  <div class="wrap">
    <section class="head">
  <img   class="lazyload" data-original="/images/theme/post-image.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="  draggable="false">
  <div class="head-mask">
    <h1 class="head-title">Mysql索引优化二</h1>
    <div class="head-info">
      <span class="post-info-item"><i class="iconfont iconcalendar"></i>May 23, 2024</span>
      
      <span class="post-info-item"><i class="iconfont iconfont-size"></i>9578</span>
    </div>
  </div>
</section>
    <section class="main">
      <section class="content">
        
        <h1 id="分页查询优化详解"><a href="#分页查询优化详解" class="headerlink" title="分页查询优化详解"></a><strong>分页查询优化详解</strong></h1><hr>
<h2 id="🌟-一、基本分页查询语法"><a href="#🌟-一、基本分页查询语法" class="headerlink" title="🌟 一、基本分页查询语法"></a>🌟 一、基本分页查询语法</h2><p>最常见的分页语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">10000</span>, <span class="hljs-number">20</span>;<br></code></pre></td></tr></table></figure>

<p>含义是：跳过前 10000 条，取 20 条记录。</p>
<hr>
<h2 id="⚠️-二、分页性能问题"><a href="#⚠️-二、分页性能问题" class="headerlink" title="⚠️ 二、分页性能问题"></a>⚠️ 二、分页性能问题</h2><h3 id="1-OFFSET-大会慢"><a href="#1-OFFSET-大会慢" class="headerlink" title="1. OFFSET 大会慢"></a>1. <strong>OFFSET 大会慢</strong></h3><p>MySQL 在执行 <code>LIMIT offset, N</code> 时，<strong>必须扫描 offset + N 条记录</strong>，再丢弃前 offset 条。</p>
<p>例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">LIMIT <span class="hljs-number">100000</span>, <span class="hljs-number">20</span>;<br></code></pre></td></tr></table></figure>

<p>实际上 MySQL 扫描了 100020 条记录，只返回最后 20 条。</p>
<h3 id="2-使用复杂-ORDER-BY-会导致额外排序"><a href="#2-使用复杂-ORDER-BY-会导致额外排序" class="headerlink" title="2. 使用复杂 ORDER BY 会导致额外排序"></a>2. <strong>使用复杂 ORDER BY 会导致额外排序</strong></h3><p>比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> name <span class="hljs-keyword">COLLATE</span> utf8_general_ci LIMIT <span class="hljs-number">10000</span>, <span class="hljs-number">20</span>;<br></code></pre></td></tr></table></figure>

<p>如果排序字段无索引，MySQL 可能要用 <strong>临时表 + 文件排序</strong>，更慢。</p>
<hr>
<h2 id="🚀-三、分页优化策略"><a href="#🚀-三、分页优化策略" class="headerlink" title="🚀 三、分页优化策略"></a>🚀 三、分页优化策略</h2><h3 id="✅-1-使用索引覆盖分页"><a href="#✅-1-使用索引覆盖分页" class="headerlink" title="✅ 1. 使用索引覆盖分页"></a>✅ 1. 使用索引覆盖分页</h3><p>避免 OFFSET，改为基于索引或主键“<strong>游标翻页</strong>”：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 第一页：</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id LIMIT <span class="hljs-number">20</span>;<br><br><span class="hljs-comment">-- 下一页（假设最后一条 id 为 10020）：</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">10020</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id LIMIT <span class="hljs-number">20</span>;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>优点：不跳过记录，性能线性增长。<br>缺点：只能按一个字段正序&#x2F;倒序翻页，不能跳转到第 N 页。</p>
</blockquote>
<h3 id="✅-2-使用子查询优化大偏移分页"><a href="#✅-2-使用子查询优化大偏移分页" class="headerlink" title="✅ 2. 使用子查询优化大偏移分页"></a>✅ 2. 使用子查询优化大偏移分页</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span><br><span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">IN</span> (<br>  <span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id LIMIT <span class="hljs-number">100000</span>, <span class="hljs-number">20</span><br>)<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id;<br></code></pre></td></tr></table></figure>

<blockquote>
<p><strong>先获取 id，再回表查数据</strong>。可以避免回表扫描大范围数据，但性能提升有限。</p>
</blockquote>
<h3 id="✅-3-分页缓存热点页"><a href="#✅-3-分页缓存热点页" class="headerlink" title="✅ 3. 分页缓存热点页"></a>✅ 3. 分页缓存热点页</h3><p>对第一页、前几页做缓存（如 Redis）。热点数据不用每次查数据库。</p>
<h3 id="✅-4-控制最大分页深度"><a href="#✅-4-控制最大分页深度" class="headerlink" title="✅ 4. 控制最大分页深度"></a>✅ 4. 控制最大分页深度</h3><p>限制最大页数，例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">if (page <span class="hljs-operator">&gt;</span> <span class="hljs-number">1000</span>) &#123;<br>  throw <span class="hljs-keyword">new</span> IllegalArgumentException(&quot;分页过深，请缩小筛选范围&quot;);<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="💡-四、MySQL-分页原理简析"><a href="#💡-四、MySQL-分页原理简析" class="headerlink" title="💡 四、MySQL 分页原理简析"></a>💡 四、MySQL 分页原理简析</h2><p>MySQL 执行 <code>LIMIT offset, size</code> 会：</p>
<ol>
<li><p>执行查询语句（扫描所有满足条件的记录）。</p>
</li>
<li><p>排序（如有 <code>ORDER BY</code>）。</p>
</li>
<li><p>丢弃 offset 条，返回 size 条。</p>
</li>
</ol>
<p>即使索引覆盖了排序字段，也需要扫描 offset + size 条记录，才开始返回。</p>
<hr>
<h2 id="🔧-五、使用分页插件优化（如-MyBatis-Plus-JPA）"><a href="#🔧-五、使用分页插件优化（如-MyBatis-Plus-JPA）" class="headerlink" title="🔧 五、使用分页插件优化（如 MyBatis-Plus &#x2F; JPA）"></a>🔧 五、使用分页插件优化（如 MyBatis-Plus &#x2F; JPA）</h2><p>MyBatis-Plus 提供了自动分页插件，但底层仍用的是 <code>LIMIT</code>，你可以结合游标优化手动控制：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">QueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>wrapper.gt(<span class="hljs-string">&quot;id&quot;</span>, lastId).orderByAsc(<span class="hljs-string">&quot;id&quot;</span>).last(<span class="hljs-string">&quot;LIMIT 20&quot;</span>);<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="📌-六、总结"><a href="#📌-六、总结" class="headerlink" title="📌 六、总结"></a>📌 六、总结</h2><table>
<thead>
<tr>
<th>方法</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>LIMIT offset, size</td>
<td>简单直接</td>
<td>offset 大时性能差</td>
</tr>
<tr>
<td>游标分页（基于 id）</td>
<td>性能好，线性增长</td>
<td>不支持跳页</td>
</tr>
<tr>
<td>子查询分页</td>
<td>中规中矩，性能稍好</td>
<td>结构复杂，回表</td>
</tr>
<tr>
<td>缓存热点页</td>
<td>秒级响应</td>
<td>数据可能不实时</td>
</tr>
<tr>
<td>限制分页深度</td>
<td>保护数据库</td>
<td>用户体验需平衡</td>
</tr>
</tbody></table>
<h1 id="表JOIN关联原理详解及优化"><a href="#表JOIN关联原理详解及优化" class="headerlink" title="表JOIN关联原理详解及优化"></a><strong>表JOIN关联原理详解及优化</strong></h1><hr>
<h2 id="🌐-一、什么是-JOIN？"><a href="#🌐-一、什么是-JOIN？" class="headerlink" title="🌐 一、什么是 JOIN？"></a>🌐 一、什么是 JOIN？</h2><p>JOIN 是 SQL 中连接多张表以组合数据的方式。</p>
<hr>
<h2 id="🔍-二、JOIN-分类-语义"><a href="#🔍-二、JOIN-分类-语义" class="headerlink" title="🔍 二、JOIN 分类 &amp; 语义"></a>🔍 二、JOIN 分类 &amp; 语义</h2><table>
<thead>
<tr>
<th>类型</th>
<th>描述</th>
<th>是否保留左表</th>
<th>是否保留右表</th>
</tr>
</thead>
<tbody><tr>
<td>INNER JOIN</td>
<td>只返回两表匹配的数据</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>LEFT JOIN</td>
<td>返回左表所有数据 + 匹配的右表数据</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>RIGHT JOIN</td>
<td>返回右表所有数据 + 匹配的左表数据</td>
<td>❌</td>
<td>✅</td>
</tr>
<tr>
<td>FULL OUTER JOIN</td>
<td>返回两表所有数据，匹配失败用 NULL 补</td>
<td>✅</td>
<td>✅</td>
</tr>
</tbody></table>
<blockquote>
<p>MySQL 不支持 FULL OUTER JOIN，可以用 UNION 模拟。</p>
</blockquote>
<hr>
<h2 id="⚙️-三、MySQL-JOIN-的底层执行原理（核心）"><a href="#⚙️-三、MySQL-JOIN-的底层执行原理（核心）" class="headerlink" title="⚙️ 三、MySQL JOIN 的底层执行原理（核心）"></a>⚙️ 三、MySQL JOIN 的底层执行原理（核心）</h2><p>MySQL 对 JOIN 的执行有两种主要算法：</p>
<h3 id="1-嵌套循环连接（Nested-Loop-Join）🔁"><a href="#1-嵌套循环连接（Nested-Loop-Join）🔁" class="headerlink" title="1. 嵌套循环连接（Nested Loop Join）🔁"></a>1. 嵌套循环连接（Nested Loop Join）🔁</h3><p>最常用，也是默认方式。直接走索引每次扫大表效率为1，以小表a驱动大表b最终效率为2a行数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> A <span class="hljs-keyword">JOIN</span> B <span class="hljs-keyword">ON</span> A.id <span class="hljs-operator">=</span> B.a_id;<br></code></pre></td></tr></table></figure>

<p>执行过程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">for row in A:<br>    for row in B:<br>        if A.id == B.a_id:<br>            输出结果<br></code></pre></td></tr></table></figure>

<blockquote>
<p>如果 B 表有索引，内循环是 “快速查找”，否则是全表扫！</p>
</blockquote>
<hr>
<h3 id="2-BNLJ（Block-Nested-Loop-Join）📦"><a href="#2-BNLJ（Block-Nested-Loop-Join）📦" class="headerlink" title="2. BNLJ（Block Nested Loop Join）📦"></a>2. BNLJ（Block Nested Loop Join）📦</h3><p>当内层表没有可用索引时，MySQL 会使用 <strong>临时表缓冲</strong>块状加载，提高效率。从大表磁盘逐条取出数据去小表的join buff中去筛选最终效率为a+b行数据</p>
<hr>
<h3 id="3-Hash-Join（MySQL-8-0-18-支持）"><a href="#3-Hash-Join（MySQL-8-0-18-支持）" class="headerlink" title="3. Hash Join（MySQL 8.0.18+ 支持）"></a>3. Hash Join（MySQL 8.0.18+ 支持）</h3><ul>
<li><p>对两个表构建哈希表连接，比嵌套循环快。</p>
</li>
<li><p>只有 <strong>Batched Key Access</strong> 或 <strong>Hash Join Hint</strong> 才可能触发。</p>
</li>
</ul>
<hr>
<h2 id="🧠-四、JOIN-性能优化技巧"><a href="#🧠-四、JOIN-性能优化技巧" class="headerlink" title="🧠 四、JOIN 性能优化技巧"></a>🧠 四、JOIN 性能优化技巧</h2><h3 id="✅-1-确保ON-条件中字段有索引"><a href="#✅-1-确保ON-条件中字段有索引" class="headerlink" title="✅ 1. 确保ON 条件中字段有索引"></a>✅ 1. 确保<strong>ON 条件中字段有索引</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- Good</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders o <span class="hljs-keyword">JOIN</span> users u <span class="hljs-keyword">ON</span> o.user_id <span class="hljs-operator">=</span> u.id;<br><br><span class="hljs-comment">-- Bad（会导致全表扫描）</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders o <span class="hljs-keyword">JOIN</span> users u <span class="hljs-keyword">ON</span> o.name <span class="hljs-operator">=</span> u.name;<br></code></pre></td></tr></table></figure>

<h3 id="✅-2-控制驱动表（外层表）大小"><a href="#✅-2-控制驱动表（外层表）大小" class="headerlink" title="✅ 2. 控制驱动表（外层表）大小"></a>✅ 2. 控制驱动表（外层表）大小</h3><ul>
<li><p>优先把<strong>小表放在外层（驱动表）</strong>。</p>
</li>
<li><p>MySQL 的优化器会根据统计信息选择执行顺序。</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-comment">/*+ STRAIGHT_JOIN */</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> small s <span class="hljs-keyword">JOIN</span> big b <span class="hljs-keyword">ON</span> s.id <span class="hljs-operator">=</span> b.sid;<br></code></pre></td></tr></table></figure>

<h3 id="✅-3-使用-SELECT-子集，别写-SELECT-❌"><a href="#✅-3-使用-SELECT-子集，别写-SELECT-❌" class="headerlink" title="✅ 3. 使用 SELECT 子集，别写 SELECT * ❌"></a>✅ 3. 使用 SELECT 子集，别写 SELECT * ❌</h3><p>减少返回列可以减少临时表数据和网络传输。</p>
<h3 id="✅-4-ON-用于连接条件，WHERE-用于过滤条件"><a href="#✅-4-ON-用于连接条件，WHERE-用于过滤条件" class="headerlink" title="✅ 4. ON 用于连接条件，WHERE 用于过滤条件"></a>✅ 4. ON 用于连接条件，WHERE 用于过滤条件</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- Good</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders o <span class="hljs-keyword">JOIN</span> users u <span class="hljs-keyword">ON</span> o.uid <span class="hljs-operator">=</span> u.id <span class="hljs-keyword">WHERE</span> u.status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br><span class="hljs-comment">-- Bad</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders o <span class="hljs-keyword">JOIN</span> users u <span class="hljs-keyword">ON</span> o.uid <span class="hljs-operator">=</span> u.id <span class="hljs-keyword">AND</span> u.status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure>

<h3 id="✅-5-用-EXPLAIN-分析-JOIN-执行计划"><a href="#✅-5-用-EXPLAIN-分析-JOIN-执行计划" class="headerlink" title="✅ 5. 用 EXPLAIN 分析 JOIN 执行计划"></a>✅ 5. 用 EXPLAIN 分析 JOIN 执行计划</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">EXPLAIN <span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">JOIN</span> ...;<br></code></pre></td></tr></table></figure>

<p>关注以下几个关键点：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>type</td>
<td>JOIN 类型，越靠近 ALL 越慢</td>
</tr>
<tr>
<td>key</td>
<td>使用的索引</td>
</tr>
<tr>
<td>rows</td>
<td>扫描行数，越少越好</td>
</tr>
<tr>
<td>Extra</td>
<td>是否使用临时表&#x2F;文件排序等</td>
</tr>
</tbody></table>
<hr>
<h2 id="🔧-五、复杂-JOIN-示例-优化分析"><a href="#🔧-五、复杂-JOIN-示例-优化分析" class="headerlink" title="🔧 五、复杂 JOIN 示例 + 优化分析"></a>🔧 五、复杂 JOIN 示例 + 优化分析</h2><h3 id="场景：订单表-用户表-商品表"><a href="#场景：订单表-用户表-商品表" class="headerlink" title="场景：订单表 + 用户表 + 商品表"></a>场景：订单表 + 用户表 + 商品表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> o.id, u.name, p.title<br><span class="hljs-keyword">FROM</span> orders o<br><span class="hljs-keyword">JOIN</span> users u <span class="hljs-keyword">ON</span> o.user_id <span class="hljs-operator">=</span> u.id<br><span class="hljs-keyword">JOIN</span> products p <span class="hljs-keyword">ON</span> o.product_id <span class="hljs-operator">=</span> p.id<br><span class="hljs-keyword">WHERE</span> u.vip <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> p.price <span class="hljs-operator">&gt;</span> <span class="hljs-number">100</span>;<br></code></pre></td></tr></table></figure>

<h3 id="优化建议："><a href="#优化建议：" class="headerlink" title="优化建议："></a>优化建议：</h3><ul>
<li><p>给 <code>orders.user_id</code>、<code>orders.product_id</code>、<code>users.id</code>、<code>products.id</code> 加索引。</p>
</li>
<li><p>加复合索引如 <code>(vip)</code> 和 <code>(price)</code>。</p>
</li>
<li><p>确保 ON 条件字段是主键或唯一索引，WHERE 是过滤条件。</p>
</li>
</ul>
<hr>
<h2 id="📌-六、索引失效的常见坑"><a href="#📌-六、索引失效的常见坑" class="headerlink" title="📌 六、索引失效的常见坑"></a>📌 六、索引失效的常见坑</h2><ul>
<li><p>JOIN 条件字段未加索引</p>
</li>
<li><p>函数、类型转换（如 <code>CAST()</code>）导致无法用索引</p>
</li>
<li><p>隐式类型转换（<code>int = &#39;abc&#39;</code>）</p>
</li>
<li><p>使用 OR 连接条件，优化器可能放弃索引</p>
</li>
</ul>
<hr>
<h2 id="🎓-七、进阶：JOIN-顺序控制技巧"><a href="#🎓-七、进阶：JOIN-顺序控制技巧" class="headerlink" title="🎓 七、进阶：JOIN 顺序控制技巧"></a>🎓 七、进阶：JOIN 顺序控制技巧</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 使用 STRAIGHT_JOIN 强制执行顺序</span><br><span class="hljs-keyword">SELECT</span> STRAIGHT_JOIN ...;<br><br><span class="hljs-comment">-- MySQL 8.0+ 支持 JOIN HINTs（优化器提示）</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-comment">/*+ JOIN_ORDER(t1, t2) */</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t1 <span class="hljs-keyword">JOIN</span> t2 <span class="hljs-keyword">ON</span> ...;<br></code></pre></td></tr></table></figure>

<h1 id="表COUNT查询优化"><a href="#表COUNT查询优化" class="headerlink" title="表COUNT查询优化"></a><strong>表COUNT查询优化</strong></h1><hr>
<h2 id="🧠-一、COUNT-是怎么执行的？"><a href="#🧠-一、COUNT-是怎么执行的？" class="headerlink" title="🧠 一、COUNT() 是怎么执行的？"></a>🧠 一、COUNT() 是怎么执行的？</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> big_table;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>InnoDB 存储引擎下，这个语句会<strong>全表扫描</strong>，逐行累加；</p>
</li>
<li><p>因为 InnoDB 的数据行是“聚簇存储”，没有维护行数元信息；</p>
</li>
<li><p>所以每次都得一个个查，<strong>即使你只想知道有多少行</strong>。</p>
</li>
</ul>
<h3 id="🚫-错误预期："><a href="#🚫-错误预期：" class="headerlink" title="🚫 错误预期："></a>🚫 错误预期：</h3><blockquote>
<p>你以为 COUNT(*) 是 O(1)，其实是 O(n)</p>
</blockquote>
<hr>
<h2 id="🔎-二、各种-COUNT-写法的差异"><a href="#🔎-二、各种-COUNT-写法的差异" class="headerlink" title="🔎 二、各种 COUNT 写法的差异"></a>🔎 二、各种 COUNT 写法的差异</h2><table>
<thead>
<tr>
<th>写法</th>
<th>含义说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>COUNT(*)</code></td>
<td>所有行，不管是否 NULL，推荐写法，优化器最快</td>
</tr>
<tr>
<td><code>COUNT(1)</code></td>
<td>等价于 <code>COUNT(*)</code>，但语义上不如 * 语义清晰</td>
</tr>
<tr>
<td><code>COUNT(column)</code></td>
<td>只统计该列非 NULL 的行，可能更慢</td>
</tr>
<tr>
<td><code>SELECT COUNT(DISTINCT col)</code></td>
<td>先排序 + 去重，性能开销较大</td>
</tr>
</tbody></table>
<p>📝 建议：默认用 <code>COUNT(*)</code>，配合条件或索引列来加速。</p>
<hr>
<h2 id="⚙️-三、COUNT-查询的常见优化手段"><a href="#⚙️-三、COUNT-查询的常见优化手段" class="headerlink" title="⚙️ 三、COUNT 查询的常见优化手段"></a>⚙️ 三、COUNT 查询的常见优化手段</h2><h3 id="✅-1-使用-COUNT-覆盖索引（避免回表）"><a href="#✅-1-使用-COUNT-覆盖索引（避免回表）" class="headerlink" title="✅ 1. 使用 COUNT(*) + 覆盖索引（避免回表）"></a>✅ 1. 使用 <code>COUNT(*)</code> + 覆盖索引（避免回表）</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 创建只包含 status 列的索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_status <span class="hljs-keyword">ON</span> orders(status);<br><br><span class="hljs-comment">-- 查询时只访问索引（无需回表）</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;NEW&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>📈 优化器会选择用索引来做扫描，而不读主键页，IO 量暴减。</p>
<hr>
<h3 id="✅-2-用-EXPLAIN-验证是否用了索引"><a href="#✅-2-用-EXPLAIN-验证是否用了索引" class="headerlink" title="✅ 2. 用 EXPLAIN 验证是否用了索引"></a>✅ 2. 用 <code>EXPLAIN</code> 验证是否用了索引</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;NEW&#x27;</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>看是否使用 <code>idx_status</code>；</p>
</li>
<li><p><code>Extra</code> 列应显示 <code>Using index</code>，代表<strong>覆盖索引生效</strong>。</p>
</li>
</ul>
<hr>
<h3 id="✅-3-条件-COUNT-——-优化过滤逻辑"><a href="#✅-3-条件-COUNT-——-优化过滤逻辑" class="headerlink" title="✅ 3. 条件 COUNT —— 优化过滤逻辑"></a>✅ 3. 条件 COUNT —— 优化过滤逻辑</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> created_at <span class="hljs-operator">&gt;=</span> <span class="hljs-string">&#x27;2024-01-01&#x27;</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>若 <code>created_at</code> 有索引，则范围过滤可以极大缩小扫描数据；</p>
</li>
<li><p>使用 <code>BETWEEN</code>、<code>IN</code>、<code>IS NULL</code> 都可以触发索引。</p>
</li>
</ul>
<hr>
<h3 id="✅-4-预估行数：使用-information-schema-tables"><a href="#✅-4-预估行数：使用-information-schema-tables" class="headerlink" title="✅ 4. 预估行数：使用 information_schema.tables"></a>✅ 4. 预估行数：使用 <code>information_schema.tables</code></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> table_name, table_rows<br><span class="hljs-keyword">FROM</span> information_schema.tables<br><span class="hljs-keyword">WHERE</span> table_schema <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;mydb&#x27;</span> <span class="hljs-keyword">AND</span> table_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;orders&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>⚠️ 注意：</p>
<ul>
<li><p><code>table_rows</code> 是估算值，不准，但速度极快；</p>
</li>
<li><p>可用于后台管理页快速显示总量。</p>
</li>
</ul>
<hr>
<h3 id="✅-5-增量维护-row-count（推荐！）"><a href="#✅-5-增量维护-row-count（推荐！）" class="headerlink" title="✅ 5. 增量维护 row count（推荐！）"></a>✅ 5. 增量维护 row count（推荐！）</h3><p>对高频 COUNT 的表，可考虑通过触发器或程序写入方式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 新增记录时 +1，删除时 -1</span><br><span class="hljs-keyword">UPDATE</span> count_meta <span class="hljs-keyword">SET</span> total <span class="hljs-operator">=</span> total <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> table_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;orders&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>适合：</p>
<ul>
<li><p>特定状态（如未读消息、待处理任务）</p>
</li>
<li><p>数据稳定、变化频率低的场景</p>
</li>
</ul>
<hr>
<h3 id="✅-6-拆分查询：分页不需要-COUNT-全量！"><a href="#✅-6-拆分查询：分页不需要-COUNT-全量！" class="headerlink" title="✅ 6. 拆分查询：分页不需要 COUNT 全量！"></a>✅ 6. 拆分查询：分页不需要 COUNT 全量！</h3><p>分页时只用 <code>limit</code> 获取部分记录，不要每次都 COUNT：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- Good</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status<span class="hljs-operator">=</span><span class="hljs-string">&#x27;NEW&#x27;</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">20</span>;<br><br><span class="hljs-comment">-- Bad</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status<span class="hljs-operator">=</span><span class="hljs-string">&#x27;NEW&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>更进一步，如果前端想“猜测是否还有下一页”：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> ... LIMIT <span class="hljs-number">21</span>;<br><span class="hljs-comment">-- 多查一条，看有没有“下一页”</span><br></code></pre></td></tr></table></figure>
<h1 id="阿里巴巴MYSQL规范解读"><a href="#阿里巴巴MYSQL规范解读" class="headerlink" title="阿里巴巴MYSQL规范解读"></a><strong>阿里巴巴MYSQL规范解读</strong></h1><hr>
<h2 id="🧭-一、阿里巴巴-MySQL-开发规范的目的"><a href="#🧭-一、阿里巴巴-MySQL-开发规范的目的" class="headerlink" title="🧭 一、阿里巴巴 MySQL 开发规范的目的"></a>🧭 一、阿里巴巴 MySQL 开发规范的目的</h2><ul>
<li><p>提高 SQL 编写规范性、可读性、可维护性；</p>
</li>
<li><p>降低数据库隐患：防止全表扫描、死锁、数据丢失；</p>
</li>
<li><p>提高性能，便于后期自动化工具识别优化空间。</p>
</li>
</ul>
<p>📄 官方规范原始地址（阿里开源）：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/p3c">阿里巴巴 Java 开发手册（数据库部分）</a></p>
</blockquote>
<hr>
<h2 id="🧱-二、建表规范（DDL）"><a href="#🧱-二、建表规范（DDL）" class="headerlink" title="🧱 二、建表规范（DDL）"></a>🧱 二、建表规范（DDL）</h2><h3 id="✅-强制要求："><a href="#✅-强制要求：" class="headerlink" title="✅ 强制要求："></a>✅ 强制要求：</h3><ol>
<li><p><strong>必须指定字段类型和长度</strong>，禁止使用 <code>TEXT</code>、<code>BLOB</code>。</p>
</li>
<li><p><strong>字段必须加注释</strong>，便于维护和数据血缘追踪。</p>
</li>
<li><p><strong>禁止使用 <code>FLOAT</code>、<code>DOUBLE</code> 存储金额</strong>，推荐 <code>DECIMAL(x,y)</code>。</p>
</li>
<li><p>所有表必须有<strong>主键（推荐自增）</strong>，且不允许使用联合主键。</p>
</li>
<li><p>所有字段必须定义为 <strong>NOT NULL</strong>，并指定默认值。</p>
</li>
</ol>
<h3 id="📌-示例："><a href="#📌-示例：" class="headerlink" title="📌 示例："></a>📌 示例：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> user_account (<br>  id <span class="hljs-type">BIGINT</span> UNSIGNED AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;主键ID&#x27;</span>,<br>  user_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;用户ID&#x27;</span>,<br>  balance <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0.00</span> COMMENT <span class="hljs-string">&#x27;余额&#x27;</span>,<br>  status TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;状态：1正常，0冻结&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY(id),<br>  <span class="hljs-keyword">UNIQUE</span> KEY uk_user (user_id)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;用户账户表&#x27;</span>;<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="📊-三、SQL-编写规范（DML）"><a href="#📊-三、SQL-编写规范（DML）" class="headerlink" title="📊 三、SQL 编写规范（DML）"></a>📊 三、SQL 编写规范（DML）</h2><h3 id="✅-强制要求：-1"><a href="#✅-强制要求：-1" class="headerlink" title="✅ 强制要求："></a>✅ 强制要求：</h3><ol>
<li><p>禁止使用 <code>SELECT *</code>，必须明确字段。</p>
</li>
<li><p>大表更新&#x2F;删除时必须加 WHERE 条件，且限制影响行数。</p>
</li>
<li><p>表别名必须简短、有意义，字段也要带上别名。</p>
</li>
<li><p>强制使用 <strong>预编译参数化 SQL</strong>，防止注入。</p>
</li>
</ol>
<h3 id="📌-正确姿势："><a href="#📌-正确姿势：" class="headerlink" title="📌 正确姿势："></a>📌 正确姿势：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 错误 ❌</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users;<br><br><span class="hljs-comment">-- 正确 ✅</span><br><span class="hljs-keyword">SELECT</span> id, username, status <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br><span class="hljs-comment">-- 更新带范围限制 ✅</span><br><span class="hljs-keyword">UPDATE</span> orders <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-number">2</span> <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> id <span class="hljs-operator">&lt;</span> <span class="hljs-number">1000</span>;<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="🧩-四、索引设计规范"><a href="#🧩-四、索引设计规范" class="headerlink" title="🧩 四、索引设计规范"></a>🧩 四、索引设计规范</h2><h3 id="✅-强制要求：-2"><a href="#✅-强制要求：-2" class="headerlink" title="✅ 强制要求："></a>✅ 强制要求：</h3><ol>
<li><p>业务查询字段必须建索引（WHERE、JOIN、ORDER BY）。</p>
</li>
<li><p>优先使用 <strong>联合索引</strong>，遵循最左前缀原则。</p>
</li>
<li><p>禁止在低选择性字段（如 status, gender）上独立建索引。</p>
</li>
<li><p>不建议超过 5 个索引，或总大小超过数据页 25%。</p>
</li>
</ol>
<h3 id="📌-示例：-1"><a href="#📌-示例：-1" class="headerlink" title="📌 示例："></a>📌 示例：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 错误 ❌</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_status <span class="hljs-keyword">ON</span> orders(status);<br><br><span class="hljs-comment">-- 正确 ✅：组合建索引更合理</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_user_status <span class="hljs-keyword">ON</span> orders(user_id, status);<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="⚠️-五、防护类规范（防止误操作）"><a href="#⚠️-五、防护类规范（防止误操作）" class="headerlink" title="⚠️ 五、防护类规范（防止误操作）"></a>⚠️ 五、防护类规范（防止误操作）</h2><ol>
<li><p>禁止生产环境使用 <code>TRUNCATE</code>。</p>
</li>
<li><p>禁止在未备份情况下执行 <code>DROP TABLE</code>。</p>
</li>
<li><p><code>DELETE</code> 必须加 <code>WHERE</code> 条件，建议加 <code>LIMIT</code> 防炸库。</p>
</li>
<li><p>DDL 操作前必须评估表行数、业务高峰期、是否有锁表风险。</p>
</li>
</ol>
<hr>
<h2 id="🚦-六、慢-SQL-与性能规范"><a href="#🚦-六、慢-SQL-与性能规范" class="headerlink" title="🚦 六、慢 SQL 与性能规范"></a>🚦 六、慢 SQL 与性能规范</h2><ol>
<li><p>查询结果限制必须加 <code>LIMIT</code>，禁止返回千万行数据。</p>
</li>
<li><p>JOIN 查询不超过三张表，关联字段必须加索引。</p>
</li>
<li><p>禁止在索引列上使用函数（如 <code>DATE(created_at)</code>），会导致索引失效。</p>
</li>
<li><p>分页时建议用 ID 方式而不是 OFFSET：</p>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 推荐写法</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span> #&#123;lastId&#125; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id <span class="hljs-keyword">ASC</span> LIMIT <span class="hljs-number">20</span>;<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="📐-七、规范化的表命名建议"><a href="#📐-七、规范化的表命名建议" class="headerlink" title="📐 七、规范化的表命名建议"></a>📐 七、规范化的表命名建议</h2><ul>
<li><p>表名为小写 + 下划线风格，如 <code>user_order</code>；</p>
</li>
<li><p>统一使用复数（<code>orders</code>、<code>products</code>）或单数风格（建议用单数）；</p>
</li>
<li><p>不允许使用拼音、无意义缩写。</p>
</li>
</ul>
<hr>
<h2 id="🛠️-八、代码层-ORM-使用建议（以-MyBatis-为例）"><a href="#🛠️-八、代码层-ORM-使用建议（以-MyBatis-为例）" class="headerlink" title="🛠️ 八、代码层 ORM 使用建议（以 MyBatis 为例）"></a>🛠️ 八、代码层 ORM 使用建议（以 MyBatis 为例）</h2><ol>
<li><p>禁止拼接 SQL，统一用参数绑定；</p>
</li>
<li><p>Mapper 方法名遵循 <code>selectByXxx</code>、<code>updateByXxx</code> 命名规范；</p>
</li>
<li><p>WHERE 条件不能为空；</p>
</li>
<li><p>批量插入建议使用 XML 批量语法，防止一条一条插。</p>
</li>
</ol>
<hr>
<h2 id="✅-总结表格：重点规范对照表"><a href="#✅-总结表格：重点规范对照表" class="headerlink" title="✅ 总结表格：重点规范对照表"></a>✅ 总结表格：重点规范对照表</h2><table>
<thead>
<tr>
<th>类别</th>
<th>规范内容</th>
<th>建议级别</th>
</tr>
</thead>
<tbody><tr>
<td>DDL</td>
<td>所有字段加注释、主键自增、禁止 FLOAT</td>
<td>强制</td>
</tr>
<tr>
<td>SQL</td>
<td>禁用 SELECT *、更新必须带 WHERE 和 LIMIT</td>
<td>强制</td>
</tr>
<tr>
<td>索引</td>
<td>联合索引优先、遵循最左匹配原则</td>
<td>强制</td>
</tr>
<tr>
<td>命名</td>
<td>表&#x2F;字段使用小写 + 下划线命名</td>
<td>推荐</td>
</tr>
<tr>
<td>运行安全</td>
<td>禁用 TRUNCATE、DROP、误删</td>
<td>强制</td>
</tr>
<tr>
<td>性能</td>
<td>查询加 LIMIT、分页用 id 游标、禁止函数索引失效</td>
<td>强制</td>
</tr>
</tbody></table>
<h1 id="MYSQL数据类型选择分析"><a href="#MYSQL数据类型选择分析" class="headerlink" title="MYSQL数据类型选择分析"></a><strong>MYSQL数据类型选择分析</strong></h1><hr>
<h2 id="🧠-为什么数据类型选择很重要？"><a href="#🧠-为什么数据类型选择很重要？" class="headerlink" title="🧠 为什么数据类型选择很重要？"></a>🧠 为什么数据类型选择很重要？</h2><blockquote>
<p>数据类型 ≠ 想当然。<br>错误的数据类型可能导致：</p>
</blockquote>
<ul>
<li><p>数据冗余、浪费存储；</p>
</li>
<li><p>索引膨胀，查询变慢；</p>
</li>
<li><p>隐式转换导致索引失效；</p>
</li>
<li><p>精度丢失（金额、时间）；</p>
</li>
</ul>
<hr>
<h2 id="📦-一、整数类型（INT-系列）"><a href="#📦-一、整数类型（INT-系列）" class="headerlink" title="📦 一、整数类型（INT 系列）"></a>📦 一、整数类型（INT 系列）</h2><table>
<thead>
<tr>
<th>类型</th>
<th>字节</th>
<th>范围（有符号）</th>
<th>使用场景</th>
</tr>
</thead>
<tbody><tr>
<td>TINYINT</td>
<td>1</td>
<td>-128 ~ 127</td>
<td>状态位、性别、布尔值等</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>2</td>
<td>-32,768 ~ 32,767</td>
<td>分级、选项等</td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>3</td>
<td>-8,388,608 ~ 8,388,607</td>
<td>用户量中等系统</td>
</tr>
<tr>
<td>INT</td>
<td>4</td>
<td>-2^31 ~ 2^31-1</td>
<td>主键常用，默认选择</td>
</tr>
<tr>
<td>BIGINT</td>
<td>8</td>
<td>-2^63 ~ 2^63-1</td>
<td>分布式 ID、雪花 ID 等</td>
</tr>
</tbody></table>
<p>✅ 建议：</p>
<ul>
<li><p>不要一上来就用 BIGINT，空间浪费大；</p>
</li>
<li><p>状态值首选 TINYINT（更快，更省）；</p>
</li>
<li><p>非负数用 <code>UNSIGNED</code>，扩大范围、避免负数；</p>
</li>
</ul>
<hr>
<h2 id="💰-二、浮点-定点（用于金额）"><a href="#💰-二、浮点-定点（用于金额）" class="headerlink" title="💰 二、浮点 &amp; 定点（用于金额）"></a>💰 二、浮点 &amp; 定点（用于金额）</h2><table>
<thead>
<tr>
<th>类型</th>
<th>字节</th>
<th>精度</th>
<th>是否推荐用于金额</th>
<th>使用说明</th>
</tr>
</thead>
<tbody><tr>
<td>FLOAT</td>
<td>4</td>
<td>约 7 位</td>
<td>❌ 不推荐</td>
<td>有误差（IEEE 754 精度）</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>8</td>
<td>约 15 位</td>
<td>❌ 不推荐</td>
<td>有误差</td>
</tr>
<tr>
<td>DECIMAL</td>
<td>N</td>
<td>高精度</td>
<td>✅ 推荐</td>
<td>金额、汇率等高精度场景</td>
</tr>
</tbody></table>
<p>✅ 建议：</p>
<ul>
<li><p>所有涉及<strong>金额、财务</strong>数据必须用 <code>DECIMAL(x, y)</code>；</p>
</li>
<li><p>如 <code>DECIMAL(10, 2)</code> 表示最大 99999999.99；</p>
</li>
<li><p>虽然 DECIMAL 性能略低，但可控、安全、不会四舍五入出错；</p>
</li>
</ul>
<hr>
<h2 id="📅-三、时间日期类型"><a href="#📅-三、时间日期类型" class="headerlink" title="📅 三、时间日期类型"></a>📅 三、时间日期类型</h2><table>
<thead>
<tr>
<th>类型</th>
<th>字节</th>
<th>范围</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>DATE</td>
<td>3</td>
<td>1000-01-01 ~ 9999-12-31</td>
<td>只存年月日</td>
</tr>
<tr>
<td>DATETIME</td>
<td>8</td>
<td>1000-01-01 00:00:00~</td>
<td>✅ 常用，支持时间索引</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>4</td>
<td>1970 ~ 2038（UTC）</td>
<td>✅ 自动更新、存储 UTC 时间</td>
</tr>
<tr>
<td>YEAR</td>
<td>1</td>
<td>1901 ~ 2155</td>
<td>一般不用</td>
</tr>
</tbody></table>
<p>✅ 建议：</p>
<ul>
<li><p>日志、业务记录推荐用 <code>DATETIME</code>；</p>
</li>
<li><p>有系统时区&#x2F;自动更新需求用 <code>TIMESTAMP</code>；</p>
</li>
<li><p>禁止用字符串（如 VARCHAR 存日期）！</p>
</li>
</ul>
<hr>
<h2 id="📄-四、字符串类型"><a href="#📄-四、字符串类型" class="headerlink" title="📄 四、字符串类型"></a>📄 四、字符串类型</h2><table>
<thead>
<tr>
<th>类型</th>
<th>最大长度</th>
<th>是否定长</th>
<th>是否推荐用于主键</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>CHAR(n)</td>
<td>0~255 字节</td>
<td>✅ 是定长</td>
<td>❌</td>
<td>固定长度，不适合变长数据</td>
</tr>
<tr>
<td>VARCHAR(n)</td>
<td>0~65535 字节</td>
<td>❌ 变长</td>
<td>✅（小心碎片）</td>
<td>最常用，支持索引</td>
</tr>
<tr>
<td>TEXT &#x2F; BLOB</td>
<td>最多 64KB</td>
<td>❌ 变长</td>
<td>❌</td>
<td>存储在外部，索引困难</td>
</tr>
</tbody></table>
<p>✅ 建议：</p>
<ul>
<li><p>短字符串（状态码等）用 CHAR；</p>
</li>
<li><p>变长字符串用 VARCHAR（注意字符集影响长度）；</p>
</li>
<li><p>长文本（如文章正文）才用 TEXT，不可用于索引字段；</p>
</li>
<li><p>UTF8 占最多 3 字节，utf8mb4 占最多 4 字节，要预估真实大小；</p>
</li>
</ul>
<hr>
<h2 id="🎯-五、布尔类型"><a href="#🎯-五、布尔类型" class="headerlink" title="🎯 五、布尔类型"></a>🎯 五、布尔类型</h2><p>MySQL 没有真正的 <code>BOOLEAN</code> 类型，它是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-type">BOOLEAN</span> ≈ TINYINT(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>

<p>✅ 建议：</p>
<ul>
<li><p>使用 <code>TINYINT(1)</code> 表示 true&#x2F;false；</p>
</li>
<li><p>不建议用 ENUM(‘true’,’false’) 这类设计；</p>
</li>
</ul>
<hr>
<h2 id="🧩-六、枚举-集合类型（ENUM-SET）"><a href="#🧩-六、枚举-集合类型（ENUM-SET）" class="headerlink" title="🧩 六、枚举&#x2F;集合类型（ENUM &#x2F; SET）"></a>🧩 六、枚举&#x2F;集合类型（ENUM &#x2F; SET）</h2><table>
<thead>
<tr>
<th>类型</th>
<th>特点</th>
<th>建议</th>
</tr>
</thead>
<tbody><tr>
<td>ENUM</td>
<td>列表中的单选值，按索引存储</td>
<td>✅ 可用</td>
</tr>
<tr>
<td>SET</td>
<td>列表中的多选值，用位表示</td>
<td>❌ 慎用</td>
</tr>
</tbody></table>
<p>✅ 建议：</p>
<ul>
<li><p><code>ENUM(&#39;male&#39;, &#39;female&#39;)</code> 用于性别、状态等小集合；</p>
</li>
<li><p>多选推荐用中间表，而不是 SET 类型（扩展性差）；</p>
</li>
</ul>
<hr>
<h2 id="⚠️-七、常见设计误区-优化建议"><a href="#⚠️-七、常见设计误区-优化建议" class="headerlink" title="⚠️ 七、常见设计误区 &amp; 优化建议"></a>⚠️ 七、常见设计误区 &amp; 优化建议</h2><table>
<thead>
<tr>
<th>误区</th>
<th>正确做法</th>
</tr>
</thead>
<tbody><tr>
<td>所有主键都用 BIGINT</td>
<td>根据业务选择 INT&#x2F;BIGINT，空间更重要</td>
</tr>
<tr>
<td>使用 VARCHAR 存 ID &#x2F; 时间</td>
<td>使用 INT 或 DATETIME&#x2F;TIMESTAMP</td>
</tr>
<tr>
<td>金额用 FLOAT</td>
<td>使用 DECIMAL(10,2)</td>
</tr>
<tr>
<td>表中所有字段都允许 NULL</td>
<td>默认 NOT NULL，明确字段用途</td>
</tr>
<tr>
<td>ENUM 多个业务混用</td>
<td>拆分业务含义清晰枚举或独立表</td>
</tr>
<tr>
<td>使用 TEXT 存储带索引字段</td>
<td>使用 VARCHAR + 索引优化</td>
</tr>
</tbody></table>
<hr>
<h2 id="📌-推荐字段类型选择表"><a href="#📌-推荐字段类型选择表" class="headerlink" title="📌 推荐字段类型选择表"></a>📌 推荐字段类型选择表</h2><table>
<thead>
<tr>
<th>业务字段</th>
<th>推荐类型</th>
</tr>
</thead>
<tbody><tr>
<td>自增主键</td>
<td>BIGINT UNSIGNED AUTO_INCREMENT</td>
</tr>
<tr>
<td>状态码</td>
<td>TINYINT</td>
</tr>
<tr>
<td>用户名&#x2F;标题</td>
<td>VARCHAR(64)</td>
</tr>
<tr>
<td>创建时间</td>
<td>DATETIME</td>
</tr>
<tr>
<td>更新时间</td>
<td>TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP</td>
</tr>
<tr>
<td>金额&#x2F;余额</td>
<td>DECIMAL(10,2)</td>
</tr>
<tr>
<td>手机号&#x2F;身份证</td>
<td>CHAR(11~18)</td>
</tr>
<tr>
<td>描述&#x2F;正文</td>
<td>TEXT</td>
</tr>
</tbody></table>

      </section>
      <section class="extra">
        
          <ul class="copyright">
  
    <li><strong>本文作者：</strong>单线程垃圾清理工</li>
    <li><strong>本文链接：</strong><a href="https://rongxiaohan.github.io/2024/05/23/Mysql%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E4%BA%8C/index.html" title="https:&#x2F;&#x2F;rongxiaohan.github.io&#x2F;2024&#x2F;05&#x2F;23&#x2F;Mysql%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E4%BA%8C&#x2F;index.html">https:&#x2F;&#x2F;rongxiaohan.github.io&#x2F;2024&#x2F;05&#x2F;23&#x2F;Mysql%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E4%BA%8C&#x2F;index.html</a></li>
    <li><strong>版权声明：</strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" title="BY-NC-SA" target="_blank" rel="noopener">BY-NC-SA</a> 许可协议，转载请注明出处！</li>
  
</ul>
        
        
        
  <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/" rel="tag">Mysql</a></li></ul> 

        
  <nav class="nav">
    <a href="/2024/05/24/Mysql%E9%94%81%E6%9C%BA%E5%88%B6%E4%B8%8E%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5%E4%BB%A5%E5%8F%8AMVCC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90/"><i class="iconfont iconleft"></i>Mysql锁机制与优化实践以及MVCC底层原理剖析</a>
    <a href="/2024/05/23/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Mysql%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8E%E9%94%81%E6%9C%BA%E5%88%B6/">深入理解Mysql事务隔离级别与锁机制<i class="iconfont iconright"></i></a>
  </nav>

      </section>
      
    </section>
  </div>
</article></div>
      <div class="col-xl-3">
        
          
  <aside class="toc-wrap">
    <h3 class="toc-title">文章目录：</h3>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E8%AF%A6%E8%A7%A3"><span class="toc-text">分页查询优化详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8C%9F-%E4%B8%80%E3%80%81%E5%9F%BA%E6%9C%AC%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E8%AF%AD%E6%B3%95"><span class="toc-text">🌟 一、基本分页查询语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9A%A0%EF%B8%8F-%E4%BA%8C%E3%80%81%E5%88%86%E9%A1%B5%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98"><span class="toc-text">⚠️ 二、分页性能问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-OFFSET-%E5%A4%A7%E4%BC%9A%E6%85%A2"><span class="toc-text">1. OFFSET 大会慢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8%E5%A4%8D%E6%9D%82-ORDER-BY-%E4%BC%9A%E5%AF%BC%E8%87%B4%E9%A2%9D%E5%A4%96%E6%8E%92%E5%BA%8F"><span class="toc-text">2. 使用复杂 ORDER BY 会导致额外排序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9A%80-%E4%B8%89%E3%80%81%E5%88%86%E9%A1%B5%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-text">🚀 三、分页优化策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-1-%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%E8%A6%86%E7%9B%96%E5%88%86%E9%A1%B5"><span class="toc-text">✅ 1. 使用索引覆盖分页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-2-%E4%BD%BF%E7%94%A8%E5%AD%90%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E5%A4%A7%E5%81%8F%E7%A7%BB%E5%88%86%E9%A1%B5"><span class="toc-text">✅ 2. 使用子查询优化大偏移分页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-3-%E5%88%86%E9%A1%B5%E7%BC%93%E5%AD%98%E7%83%AD%E7%82%B9%E9%A1%B5"><span class="toc-text">✅ 3. 分页缓存热点页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-4-%E6%8E%A7%E5%88%B6%E6%9C%80%E5%A4%A7%E5%88%86%E9%A1%B5%E6%B7%B1%E5%BA%A6"><span class="toc-text">✅ 4. 控制最大分页深度</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%92%A1-%E5%9B%9B%E3%80%81MySQL-%E5%88%86%E9%A1%B5%E5%8E%9F%E7%90%86%E7%AE%80%E6%9E%90"><span class="toc-text">💡 四、MySQL 分页原理简析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%A7-%E4%BA%94%E3%80%81%E4%BD%BF%E7%94%A8%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6%E4%BC%98%E5%8C%96%EF%BC%88%E5%A6%82-MyBatis-Plus-JPA%EF%BC%89"><span class="toc-text">🔧 五、使用分页插件优化（如 MyBatis-Plus &#x2F; JPA）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8C-%E5%85%AD%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-text">📌 六、总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%A8JOIN%E5%85%B3%E8%81%94%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E5%8F%8A%E4%BC%98%E5%8C%96"><span class="toc-text">表JOIN关联原理详解及优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8C%90-%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF-JOIN%EF%BC%9F"><span class="toc-text">🌐 一、什么是 JOIN？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%8D-%E4%BA%8C%E3%80%81JOIN-%E5%88%86%E7%B1%BB-%E8%AF%AD%E4%B9%89"><span class="toc-text">🔍 二、JOIN 分类 &amp; 语义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9A%99%EF%B8%8F-%E4%B8%89%E3%80%81MySQL-JOIN-%E7%9A%84%E5%BA%95%E5%B1%82%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86%EF%BC%88%E6%A0%B8%E5%BF%83%EF%BC%89"><span class="toc-text">⚙️ 三、MySQL JOIN 的底层执行原理（核心）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%B5%8C%E5%A5%97%E5%BE%AA%E7%8E%AF%E8%BF%9E%E6%8E%A5%EF%BC%88Nested-Loop-Join%EF%BC%89%F0%9F%94%81"><span class="toc-text">1. 嵌套循环连接（Nested Loop Join）🔁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-BNLJ%EF%BC%88Block-Nested-Loop-Join%EF%BC%89%F0%9F%93%A6"><span class="toc-text">2. BNLJ（Block Nested Loop Join）📦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Hash-Join%EF%BC%88MySQL-8-0-18-%E6%94%AF%E6%8C%81%EF%BC%89"><span class="toc-text">3. Hash Join（MySQL 8.0.18+ 支持）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A7%A0-%E5%9B%9B%E3%80%81JOIN-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7"><span class="toc-text">🧠 四、JOIN 性能优化技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-1-%E7%A1%AE%E4%BF%9DON-%E6%9D%A1%E4%BB%B6%E4%B8%AD%E5%AD%97%E6%AE%B5%E6%9C%89%E7%B4%A2%E5%BC%95"><span class="toc-text">✅ 1. 确保ON 条件中字段有索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-2-%E6%8E%A7%E5%88%B6%E9%A9%B1%E5%8A%A8%E8%A1%A8%EF%BC%88%E5%A4%96%E5%B1%82%E8%A1%A8%EF%BC%89%E5%A4%A7%E5%B0%8F"><span class="toc-text">✅ 2. 控制驱动表（外层表）大小</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-3-%E4%BD%BF%E7%94%A8-SELECT-%E5%AD%90%E9%9B%86%EF%BC%8C%E5%88%AB%E5%86%99-SELECT-%E2%9D%8C"><span class="toc-text">✅ 3. 使用 SELECT 子集，别写 SELECT * ❌</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-4-ON-%E7%94%A8%E4%BA%8E%E8%BF%9E%E6%8E%A5%E6%9D%A1%E4%BB%B6%EF%BC%8CWHERE-%E7%94%A8%E4%BA%8E%E8%BF%87%E6%BB%A4%E6%9D%A1%E4%BB%B6"><span class="toc-text">✅ 4. ON 用于连接条件，WHERE 用于过滤条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-5-%E7%94%A8-EXPLAIN-%E5%88%86%E6%9E%90-JOIN-%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="toc-text">✅ 5. 用 EXPLAIN 分析 JOIN 执行计划</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%A7-%E4%BA%94%E3%80%81%E5%A4%8D%E6%9D%82-JOIN-%E7%A4%BA%E4%BE%8B-%E4%BC%98%E5%8C%96%E5%88%86%E6%9E%90"><span class="toc-text">🔧 五、复杂 JOIN 示例 + 优化分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%EF%BC%9A%E8%AE%A2%E5%8D%95%E8%A1%A8-%E7%94%A8%E6%88%B7%E8%A1%A8-%E5%95%86%E5%93%81%E8%A1%A8"><span class="toc-text">场景：订单表 + 用户表 + 商品表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE%EF%BC%9A"><span class="toc-text">优化建议：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8C-%E5%85%AD%E3%80%81%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E7%9A%84%E5%B8%B8%E8%A7%81%E5%9D%91"><span class="toc-text">📌 六、索引失效的常见坑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8E%93-%E4%B8%83%E3%80%81%E8%BF%9B%E9%98%B6%EF%BC%9AJOIN-%E9%A1%BA%E5%BA%8F%E6%8E%A7%E5%88%B6%E6%8A%80%E5%B7%A7"><span class="toc-text">🎓 七、进阶：JOIN 顺序控制技巧</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%A8COUNT%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-text">表COUNT查询优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A7%A0-%E4%B8%80%E3%80%81COUNT-%E6%98%AF%E6%80%8E%E4%B9%88%E6%89%A7%E8%A1%8C%E7%9A%84%EF%BC%9F"><span class="toc-text">🧠 一、COUNT() 是怎么执行的？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%9A%AB-%E9%94%99%E8%AF%AF%E9%A2%84%E6%9C%9F%EF%BC%9A"><span class="toc-text">🚫 错误预期：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%8E-%E4%BA%8C%E3%80%81%E5%90%84%E7%A7%8D-COUNT-%E5%86%99%E6%B3%95%E7%9A%84%E5%B7%AE%E5%BC%82"><span class="toc-text">🔎 二、各种 COUNT 写法的差异</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9A%99%EF%B8%8F-%E4%B8%89%E3%80%81COUNT-%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%B8%B8%E8%A7%81%E4%BC%98%E5%8C%96%E6%89%8B%E6%AE%B5"><span class="toc-text">⚙️ 三、COUNT 查询的常见优化手段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-1-%E4%BD%BF%E7%94%A8-COUNT-%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95%EF%BC%88%E9%81%BF%E5%85%8D%E5%9B%9E%E8%A1%A8%EF%BC%89"><span class="toc-text">✅ 1. 使用 COUNT(*) + 覆盖索引（避免回表）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-2-%E7%94%A8-EXPLAIN-%E9%AA%8C%E8%AF%81%E6%98%AF%E5%90%A6%E7%94%A8%E4%BA%86%E7%B4%A2%E5%BC%95"><span class="toc-text">✅ 2. 用 EXPLAIN 验证是否用了索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-3-%E6%9D%A1%E4%BB%B6-COUNT-%E2%80%94%E2%80%94-%E4%BC%98%E5%8C%96%E8%BF%87%E6%BB%A4%E9%80%BB%E8%BE%91"><span class="toc-text">✅ 3. 条件 COUNT —— 优化过滤逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-4-%E9%A2%84%E4%BC%B0%E8%A1%8C%E6%95%B0%EF%BC%9A%E4%BD%BF%E7%94%A8-information-schema-tables"><span class="toc-text">✅ 4. 预估行数：使用 information_schema.tables</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-5-%E5%A2%9E%E9%87%8F%E7%BB%B4%E6%8A%A4-row-count%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%81%EF%BC%89"><span class="toc-text">✅ 5. 增量维护 row count（推荐！）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-6-%E6%8B%86%E5%88%86%E6%9F%A5%E8%AF%A2%EF%BC%9A%E5%88%86%E9%A1%B5%E4%B8%8D%E9%9C%80%E8%A6%81-COUNT-%E5%85%A8%E9%87%8F%EF%BC%81"><span class="toc-text">✅ 6. 拆分查询：分页不需要 COUNT 全量！</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4MYSQL%E8%A7%84%E8%8C%83%E8%A7%A3%E8%AF%BB"><span class="toc-text">阿里巴巴MYSQL规范解读</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A7%AD-%E4%B8%80%E3%80%81%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4-MySQL-%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83%E7%9A%84%E7%9B%AE%E7%9A%84"><span class="toc-text">🧭 一、阿里巴巴 MySQL 开发规范的目的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A7%B1-%E4%BA%8C%E3%80%81%E5%BB%BA%E8%A1%A8%E8%A7%84%E8%8C%83%EF%BC%88DDL%EF%BC%89"><span class="toc-text">🧱 二、建表规范（DDL）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E5%BC%BA%E5%88%B6%E8%A6%81%E6%B1%82%EF%BC%9A"><span class="toc-text">✅ 强制要求：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C-%E7%A4%BA%E4%BE%8B%EF%BC%9A"><span class="toc-text">📌 示例：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8A-%E4%B8%89%E3%80%81SQL-%E7%BC%96%E5%86%99%E8%A7%84%E8%8C%83%EF%BC%88DML%EF%BC%89"><span class="toc-text">📊 三、SQL 编写规范（DML）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E5%BC%BA%E5%88%B6%E8%A6%81%E6%B1%82%EF%BC%9A-1"><span class="toc-text">✅ 强制要求：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C-%E6%AD%A3%E7%A1%AE%E5%A7%BF%E5%8A%BF%EF%BC%9A"><span class="toc-text">📌 正确姿势：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A7%A9-%E5%9B%9B%E3%80%81%E7%B4%A2%E5%BC%95%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83"><span class="toc-text">🧩 四、索引设计规范</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E5%BC%BA%E5%88%B6%E8%A6%81%E6%B1%82%EF%BC%9A-2"><span class="toc-text">✅ 强制要求：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C-%E7%A4%BA%E4%BE%8B%EF%BC%9A-1"><span class="toc-text">📌 示例：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9A%A0%EF%B8%8F-%E4%BA%94%E3%80%81%E9%98%B2%E6%8A%A4%E7%B1%BB%E8%A7%84%E8%8C%83%EF%BC%88%E9%98%B2%E6%AD%A2%E8%AF%AF%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="toc-text">⚠️ 五、防护类规范（防止误操作）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9A%A6-%E5%85%AD%E3%80%81%E6%85%A2-SQL-%E4%B8%8E%E6%80%A7%E8%83%BD%E8%A7%84%E8%8C%83"><span class="toc-text">🚦 六、慢 SQL 与性能规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%90-%E4%B8%83%E3%80%81%E8%A7%84%E8%8C%83%E5%8C%96%E7%9A%84%E8%A1%A8%E5%91%BD%E5%90%8D%E5%BB%BA%E8%AE%AE"><span class="toc-text">📐 七、规范化的表命名建议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9B%A0%EF%B8%8F-%E5%85%AB%E3%80%81%E4%BB%A3%E7%A0%81%E5%B1%82-ORM-%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE%EF%BC%88%E4%BB%A5-MyBatis-%E4%B8%BA%E4%BE%8B%EF%BC%89"><span class="toc-text">🛠️ 八、代码层 ORM 使用建议（以 MyBatis 为例）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9C%85-%E6%80%BB%E7%BB%93%E8%A1%A8%E6%A0%BC%EF%BC%9A%E9%87%8D%E7%82%B9%E8%A7%84%E8%8C%83%E5%AF%B9%E7%85%A7%E8%A1%A8"><span class="toc-text">✅ 总结表格：重点规范对照表</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MYSQL%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E9%80%89%E6%8B%A9%E5%88%86%E6%9E%90"><span class="toc-text">MYSQL数据类型选择分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A7%A0-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E9%80%89%E6%8B%A9%E5%BE%88%E9%87%8D%E8%A6%81%EF%BC%9F"><span class="toc-text">🧠 为什么数据类型选择很重要？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%A6-%E4%B8%80%E3%80%81%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B%EF%BC%88INT-%E7%B3%BB%E5%88%97%EF%BC%89"><span class="toc-text">📦 一、整数类型（INT 系列）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%92%B0-%E4%BA%8C%E3%80%81%E6%B5%AE%E7%82%B9-%E5%AE%9A%E7%82%B9%EF%BC%88%E7%94%A8%E4%BA%8E%E9%87%91%E9%A2%9D%EF%BC%89"><span class="toc-text">💰 二、浮点 &amp; 定点（用于金额）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%85-%E4%B8%89%E3%80%81%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E7%B1%BB%E5%9E%8B"><span class="toc-text">📅 三、时间日期类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%84-%E5%9B%9B%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B"><span class="toc-text">📄 四、字符串类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8E%AF-%E4%BA%94%E3%80%81%E5%B8%83%E5%B0%94%E7%B1%BB%E5%9E%8B"><span class="toc-text">🎯 五、布尔类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A7%A9-%E5%85%AD%E3%80%81%E6%9E%9A%E4%B8%BE-%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B%EF%BC%88ENUM-SET%EF%BC%89"><span class="toc-text">🧩 六、枚举&#x2F;集合类型（ENUM &#x2F; SET）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9A%A0%EF%B8%8F-%E4%B8%83%E3%80%81%E5%B8%B8%E8%A7%81%E8%AE%BE%E8%AE%A1%E8%AF%AF%E5%8C%BA-%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="toc-text">⚠️ 七、常见设计误区 &amp; 优化建议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8C-%E6%8E%A8%E8%8D%90%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B%E9%80%89%E6%8B%A9%E8%A1%A8"><span class="toc-text">📌 推荐字段类型选择表</span></a></li></ol></li></ol>
  </aside>

        
      </div>
    </div>
  </div>
</main>
  

<footer class="footer">
  <div class="footer-social"><a 
        href="tencent://message/?Menu=yes&uin=894519210 "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#12B7F5'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconQQ "></i>
      </a><a 
        href="javascript:; "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#09BB07'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconwechat-fill "></i>
      </a><a 
        href="https://www.instagram.com/izhaoo/ "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#DA2E76'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconinstagram "></i>
      </a><a 
        href="https://github.com/zhaoo "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#9f7be1'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  icongithub-fill "></i>
      </a><a 
        href="mailto:izhaoo@163.com "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color=#FF3B00" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconmail"></i>
      </a></div>
  
    <div class="footer-copyright"><p></p></div>
  
</footer>
  
      <div class="fab fab-plus">
    <i class="iconfont iconplus"></i>
  </div>
  
  
  
  <div class="fab fab-up">
    <i class="iconfont iconcaret-up"></i>
  </div>
  
  
    <div class="scrollbar j-scrollbar">
  <div class="scrollbar-current j-scrollbar-current"></div>
</div>
  
  
    
<script src="/js/color-mode.js"></script>

  
  
</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>





  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>




  
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>






  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>




<script src="/js/utils.js"></script>
<script src="/js/script.js"></script>







  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>












</html>